<beast version='2.0'
       namespace='beast.core:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.branchratemodel:beast.evolution.likelihood:beast.core.parameter:beast.math.distributions'>

    <!-- The sequence alignment                                                  -->
    <!-- ntax=6 nchar=768                                                        -->
    <!-- npatterns=69                                                            -->
    <data id="alignment" dataType="nucleotide">
        <sequence taxon="human">
            AGAAATATGTCTGATAAAAGAGTTACTTTGATAGAGTAAATAATAGGAGCTTAAACCCCCTTATTTCTACTAGGACTATGAGAATCGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCGTACTAAGAAATTTAGGTTAAATACAGACCAAGAGCCTTCAAAGCCCTCAGTAAGTTG-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGACCAATGGGACTTAAACCCACAAACACTTAGTTAACAGCTAAGCACCCTAATCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAA-TCACCTCGGAGCTTGGTAAAAAGAGGCCTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCCAAAGCTGGTTTCAAGCCAACCCCATGGCCTCCATGACTTTTTCAAAAGGTATTAGAAAAACCATTTCATAACTTTGTCAAAGTTAAATTATAGGCT-AAATCCTATATATCTTA-CACTGTAAAGCTAACTTAGCATTAACCTTTTAAGTTAAAGATTAAGAGAACCAACACCTCTTTACAGTGA
        </sequence>
        <sequence taxon="chimp">
            AGAAATATGTCTGATAAAAGAATTACTTTGATAGAGTAAATAATAGGAGTTCAAATCCCCTTATTTCTACTAGGACTATAAGAATCGAACTCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTACACCCTTCCCGTACTAAGAAATTTAGGTTAAGCACAGACCAAGAGCCTTCAAAGCCCTCAGCAAGTTA-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATTAATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAATCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAA-TCACCTCAGAGCTTGGTAAAAAGAGGCTTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCTAAAGCTGGTTTCAAGCCAACCCCATGACCTCCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATTACAGGTT-AACCCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGATTAAGAGGACCGACACCTCTTTACAGTGA
        </sequence>
        <sequence taxon="bonobo">
            AGAAATATGTCTGATAAAAGAATTACTTTGATAGAGTAAATAATAGGAGTTTAAATCCCCTTATTTCTACTAGGACTATGAGAGTCGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCGTACTAAGAAATTTAGGTTAAACACAGACCAAGAGCCTTCAAAGCTCTCAGTAAGTTA-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATTAATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAATCAGC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTTGAATTTGCAATTCAATATGAAAA-TCACCTCAGAGCTTGGTAAAAAGAGGCTTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCTAAAGCTGGTTTCAAGCCAACCCCATGACCCCCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATTACAGGTT-AAACCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGATTAAGAGGACCAACACCTCTTTACAGTGA
        </sequence>
        <sequence taxon="gorilla">
            AGAAATATGTCTGATAAAAGAGTTACTTTGATAGAGTAAATAATAGAGGTTTAAACCCCCTTATTTCTACTAGGACTATGAGAATTGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTGTCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTCACATCCTTCCCGTACTAAGAAATTTAGGTTAAACATAGACCAAGAGCCTTCAAAGCCCTTAGTAAGTTA-CAACACTTAATTTCTGTAAGGACTGCAAAACCCTACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATCAATGGGACTCAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAGTCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAT-TCACCTCGGAGCTTGGTAAAAAGAGGCCCAGCCTCTGTCTTTAGATTTACAGTCCAATGCCTTA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCCAAAGCTGGTTTCAAGCCAACCCCATGACCTTCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAGGTTAAATTACGGGTT-AAACCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCGTTAACCTTTTAAGTTAAAGATTAAGAGTATCGGCACCTCTTTGCAGTGA
        </sequence>
        <sequence taxon="orangutan">
            AGAAATATGTCTGACAAAAGAGTTACTTTGATAGAGTAAAAAATAGAGGTCTAAATCCCCTTATTTCTACTAGGACTATGGGAATTGAACCCACCCCTGAGAATCCAAAATTCTCCGTGCCACCCATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTACACCCTTCCCGTACTAAGAAATTTAGGTTA--CACAGACCAAGAGCCTTCAAAGCCCTCAGCAAGTCA-CAGCACTTAATTTCTGTAAGGACTGCAAAACCCCACTTTGCATCAACTGAGCGCAAATCAGCCACTTTAATTAAGCTAAGCCCTCCTAGACCGATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAGTCAAT-TGGCTTCAGTCCAAAGCCCCGGCAGGCCTTAAAGCTGCTCCTTCGAATTTGCAATTCAACATGACAA-TCACCTCAGGGCTTGGTAAAAAGAGGTCTGACCCCTGTTCTTAGATTTACAGCCTAATGCCTTAACTCGGCCATTTTACCGCAAAAAAGGAAGGAATCGAACCTCCTAAAGCTGGTTTCAAGCCAACCCCATAACCCCCATGACTTTTTCAAAAGGTACTAGAAAAACCATTTCGTAACTTTGTCAAAGTTAAATTACAGGTC-AGACCCTGTGTATCTTA-CATTGCAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGACTAAGAGAACCAGCCTCTCTTTGCAATGA
        </sequence>
        <sequence taxon="siamang">
            AGAAATACGTCTGACGAAAGAGTTACTTTGATAGAGTAAATAACAGGGGTTTAAATCCCCTTATTTCTACTAGAACCATAGGAGTCGAACCCATCCTTGAGAATCCAAAACTCTCCGTGCCACCCGTCGCACCCTGTTCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCATACTAAGAAATTTAGGTTAAACACAGACCAAGAGCCTTCAAAGCCCTCAGTAAGTTAACAAAACTTAATTTCTGCAAGGGCTGCAAAACCCTACTTTGCATCAACCGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATCGATGGGACTTAAACCCATAAAAATTTAGTTAACAGCTAAACACCCTAAACAACCTGGCTTCAATCTAAAGCCCCGGCAGA-GTTGAAGCTGCTTCTTTGAACTTGCAATTCAACGTGAAAAATCACTTCGGAGCTTGGCAAAAAGAGGTTTCACCTCTGTCCTTAGATTTACAGTCTAATGCTTTA-CTCAGCCACTTTACCACAAAAAAGGAAGGAATCGAACCCTCTAAAACCGGTTTCAAGCCAGCCCCATAACCTTTATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATCACAGGTCCAAACCCCGTATATCTTATCACTGTAGAGCTAGACCAGCATTAACCTTTTAAGTTAAAGACTAAGAGAACTACCGCCTCTTTACAGTGA
        </sequence>
    </data>


    <input spec="ParameterList" id="parameterList">
        <parameter spec="QuietRealParameter" id="parameter1" value="0.0 0.0 0.0 0.0 0.0 0.0" upper="Infinity" lower="-Infinity"/>
    </input>

    <input spec="DPPointer" id="param.pointers">
        <input name="uniqueParameter" idref="parameter1"/>
        <input name="initialAssignment" spec="IntegerParameter" value="0" dimension="768" lower="0"/>
    </input>

    <input spec="ParameterList" id="modelList">
        <parameter spec="QuietRealParameter" id="parameter2" value="5.0" upper="5.0" lower="3.0"/>
    </input>

    <input spec="DPPointer" id="model.pointers">
        <input name="uniqueParameter" idref="parameter2"/>
        <input name="initialAssignment" spec="IntegerParameter" value="0" dimension="768" lower="0"/>
    </input>

    <input spec="ParameterList" id="freqsList">
        <parameter spec="QuietRealParameter" id="parameter3" value="0.25 0.25 0.25 0.25" upper="1.0" lower="0.0"/>
    </input>

    <input spec="DPPointer" id="freq.pointers">
        <input name="uniqueParameter" idref="parameter3"/>
        <input name="initialAssignment" spec="IntegerParameter" value="0" dimension="768" lower="0"/>
    </input>


    <input spec="DPNtdBMA" id="dpNtdBMA">
        <input name="paramList" spec="ParameterList" idref="parameterList"/>
        <input name="modelList" spec="ParameterList" idref="modelList"/>
        <input name="freqsList" spec="ParameterList" idref="freqsList"/>
        <input name="paramPointers" spec="DPPointer" idref="param.pointers"/>
        <input name="modelPointers" spec="DPPointer" idref="model.pointers"/>
        <input name="freqPointers" spec="DPPointer" idref="freq.pointers"/>
    </input>

    <input spec="DPNtdSiteModel" id="dpNtdSiteModel">
        <input name="ntdBMAList" idref="dpNtdBMA"/>
        <input name="mu" spec="RealParameter" id="mu" value="1.0" lower="0.0" upper="Infinity"/>
    </input>

    <tree spec='beast.util.ClusterTree' id='tree' clusterType='upgma'>
        <taxa idref='alignment'/>
    </tree>

    <input spec="StrictClockModel" id="strict.clock">
        <input name="clock.rate" idref="mu"/>
    </input>

    <input spec='DPTreeLikelihood' id="treeLikelihood">
        <data idref="alignment"/>
        <tree idref="tree"/>
        <siteModelList idref="dpNtdSiteModel"/>
        <branchRateModel idref="strict.clock"/>
    </input>


    <!-- The HKY substitution model (Hasegawa, Kishino & Yano, 1985)             -->
    <input spec='HKY' id='hky'>
        <input name="kappa" spec="RealParameter" id='hky.kappa' value="1.0" lower="0.0" upper="Infinity"/>
        <frequencies id='freqs' spec='Frequencies'>
            <!--data idref='alignment'/-->
            <input spec="RealParameter" name="frequencies" value="0.25 0.25 0.25 0.25" lower="0" upper="1"/>
        </frequencies>
    </input>

    <!-- site model                                                              -->
    <input spec='SiteModel' id="dummySiteModel">
        <substModel idref='hky'/>
    </input>

    <input spec='TempTreeLikelihood' id="tempTreeLikelihood">
        <data idref="alignment"/>
        <tree idref="tree"/>
        <siteModel idref="dummySiteModel"/>
        <branchRateModel idref="strict.clock"/>
    </input>
    <!--input spec="DummyLikelihood" id="likelihood">
        <input name="plugin" idref="dpNtdSiteModel"/>
    </input-->

    <input spec="DPValuable" id="dpValuable">
        <input spec="ParameterList" name="paramList" idref="freqsList"/>
        <input spec="DPPointer" name="pointers" idref="freq.pointers"/>
    </input>

    <input spec="NtdDP" id="ntddp">
        <input name="dpVal" idref="dpValuable"/>
        <input name="paramBaseDistr" spec="beast.math.distributions.MultivariateNormal">
            <input name="mean" spec="RealParameter" value="0 0 0 0 0 0"/>
            <input name="precision" spec="MatrixParameter">
                <parameter value="1.0 0 0 0 0 0"/>
                <parameter value="0 1.0 0 0 0 0"/>
                <parameter value="0 0 1.0 0 0 0"/>
                <parameter value="0 0 0 1.0 0 0"/>
                <parameter value="0 0 0 0 1.0 0"/>
                <parameter value="0 0 0 0 0 1.0"/>
            </input>
        </input>
        <input name="modelBaseDistr" spec="beast.math.distributions.IntegerUniformDistribution" lower="3.0" upper="5.0"/>
        <input name="freqBaseDistr" spec="beast.math.distributions.DirichletDistribution">
            <input name="alpha" spec="RealParameter" value="1.0 1.0 1.0 1.0" lower="0" upper="1.0"/>
        </input>
        <input name="alpha" spec="RealParameter" value="1.0" lower="0.0" upper="Infinity"/>
    </input>

    <input spec="Count" id="model.count">
        <input name="list" idref="dpNtdBMA"/>
    </input>

    <input spec="Count" id="siteModel.count">
        <input name="list" idref="dpNtdSiteModel"/>
    </input>

    <input spec="Count" id="treeLik.count">
        <input name="list" idref="treeLikelihood"/>
    </input>

    <input spec="Weights" id="treeLik.weight">
        <input name="dpTreeLik" idref="treeLikelihood"/>
    </input>

    <input spec="Indices" id="model.indices">
        <input name="dpNtdBMA" idref="dpNtdBMA"/>
    </input>
    <!--run spec="MCMC" id="mcmc" chainLength="100"--> <!--autoOptimize="true"-->
    <run spec="MCMC" id="mcmc" chainLength="10000000">
        <state>
            <input name='stateNode' idref='parameterList'/>
            <input name='stateNode' idref='modelList'/>
            <input name='stateNode' idref='freqsList'/>
            <input name='stateNode' idref='param.pointers'/>
            <input name='stateNode' idref='model.pointers'/>
            <input name='stateNode' idref='freq.pointers'/>
            <input name="stateNode" idref="tree"/>
        </state>

        <distribution spec="CompoundDistribution" id="posterior">
            <distribution idref="treeLikelihood"/>
            <!--distribution id="prior" spec="beast.math.distributions.ParameterListPrior" applyToList="true">
                <input name="distribution" idref="ntddp"/>
                <xList idref="parameterList"/>
            </distribution-->
        </distribution>
        <operator id='treeScaler' spec='ScaleOperator' scaleFactor="0.5" weight="1" tree="@tree"/>
        <operator spec='Uniform' weight="10" tree="@tree"/>
        <operator spec='SubtreeSlide' weight="5" gaussian="true" size="1.0" tree="@tree"/>
        <operator id='narrow' spec='Exchange' isNarrow='true' weight="1" tree="@tree"/>
        <operator id='wide' spec='Exchange' isNarrow='false' weight="1" tree="@tree"/>
        <operator spec='WilsonBalding' weight="1" tree="@tree"/>

        <operator id="dpps" spec="NtdBMADPPGibbsSampler" weight="3" sampleSize="5">
            <input name="tempLikelihood" idref="tempTreeLikelihood"/>
            <input name="parameterList" idref="parameterList"/>
            <input name="parameterPointers" idref="param.pointers"/>
            <input name="modelList" idref="modelList"/>
            <input name="modelPointers" idref="model.pointers"/>
            <input name="freqsList" idref="freqsList"/>
            <input name="freqPointers" idref="freq.pointers"/>
            <input name="dirichletProcess" idref="ntddp"/>
            <input name="dpTreeLik" idref="treeLikelihood"/>
            <input name="dpVal" idref="dpValuable"/>
        </operator>

        <operator id="plerrwo" spec="PLExtendedRealRandomWalkOperator" windowSizes="0.5 0.01 0.1 0.1 0.1 0.1" weight="1">
            <input name="parameters" idref="parameterList"/>
        </operator>
        <operator id="plirwop" spec="PLIntegerRandomWalkOperator" windowSize="2" weight="1">
            <input name="parameters" idref="modelList"/>
        </operator>
        <operator id="errwo" spec="PLDeltaExchangeOperator" delta="0.05" weight="1">
            <input name="parameterList" idref="freqsList"/>
        </operator>

        <!--logger logEvery="1"-->
        <logger logEvery="10000">
            <log idref="posterior"/>
            <log idref="treeLikelihood"/>
            <log idref="dpValuable"/>
            <log idref="model.count"/>
            <log idref="siteModel.count"/>
            <log idref="treeLik.count"/>
            <!--log idref="modelList"/>
            <log idref="model.indices"/-->
            <!--log idref="param.pointers"/>
            <log idref="model.pointers"/>
            <log idref="freq.pointers"/-->
        </logger>


        <logger logEvery="10000" fileName="testTempTreeLikelihood_4.log">
            <log idref="dpValuable"/>
            <log idref="treeLikelihood"/>
            <log idref="treeLik.count"/>
            <log idref="model.indices"/>
            <!--log idref="param.pointers"/>
            <log idref="model.pointers"/>
            <log idref="freq.pointers"/-->
        </logger>



    </run>
</beast>